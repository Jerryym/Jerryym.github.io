---
title: UnityShaderå­¦ä¹ ç¬”è®°-å‡¹å‡¸è´´å›¾
published: 2025-07-12
description: ''
image: ''
tags: [Unity, Shader]
category: UnityShader
draft: false 
lang: ''
---
åœ¨çœŸå®ä¸–ç•Œä¸­ï¼Œç‰©ä½“è¡¨é¢çš„ç»†èŠ‚ï¼ˆå¦‚ç –å—çš„è£‚çº¹ã€çš®è‚¤çš„æ¯›å­”ã€é‡‘å±çš„åˆ’ç—•ï¼‰ä¼šå½±å“å…‰çš„åå°„æ–¹å‘ï¼Œä»è€Œå½¢æˆå¤æ‚çš„æ˜æš—å˜åŒ–ã€‚ç„¶è€Œï¼Œåœ¨3Då›¾å½¢ä¸­ï¼Œè‹¥å®Œå…¨ä¾é å‡ ä½•æ¨¡å‹å»åˆ»ç”»è¿™äº›ç»†èŠ‚ï¼Œä¸ä»…å·¥ä½œé‡å·¨å¤§ï¼Œè¿˜ä¼šä¸¥é‡å½±å“æ¸²æŸ“æ€§èƒ½ã€‚

**å‡¹å‡¸è´´å›¾(Bump Mapping)** æ˜¯ä¸€ç§é€šè¿‡ **ä¿®æ”¹è¡¨é¢æ³•çº¿æ–¹å‘** æ¥æ¨¡æ‹Ÿè¿™äº›ç»†èŠ‚çš„æŠ€æœ¯ã€‚å®ƒä¸æ”¹å˜æ¨¡å‹çš„é¡¶ç‚¹ä½ç½®ï¼Œè€Œæ˜¯åœ¨å…‰ç…§è®¡ç®—ä¸­â€œæ¬ºéª—â€çœ¼ç›ï¼Œè®©è¡¨é¢çœ‹èµ·æ¥æ›´åŠ å¤æ‚ã€ç«‹ä½“ã€çœŸå®ã€‚

## å®ç°å‡¹å‡¸è´´å›¾çš„æ–¹æ³•

å®ç°å‡¹å‡¸è´´å›¾çš„æ–¹æ³•ä¸»è¦æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯ä½¿ç”¨ä¸€å¼ é«˜åº¦çº¹ç†è´´å›¾æ¥æ¨¡æ‹Ÿè¡¨é¢å”¯ä¸€ï¼Œç„¶åè®¡ç®—å¾—å‡ºä¸€ä¸ªä¿®æ”¹åçš„æ³•çº¿å‘é‡ï¼›å¦ä¸€ç§æ˜¯ä½¿ç”¨ä¸€å¼ æ³•çº¿çº¹ç†è´´å›¾æ¥ç›´æ¥å­˜å‚¨è¡¨é¢æ³•çº¿ã€‚

### é«˜åº¦è´´å›¾

* é«˜åº¦è´´å›¾ä½¿ç”¨åƒç´ é¢œè‰²æ¥è¡¨ç¤ºè¡¨é¢é«˜åº¦
* é«˜åº¦è´´å›¾å›¾åƒé€šå¸¸ä¸º**ç°åº¦å›¾**
* ä¸€èˆ¬ä¼šä½¿ç”¨Terragenç­‰è½¯ä»¶ç”Ÿæˆé«˜åº¦è´´å›¾
* **ä¼˜ç‚¹ï¼š** ç›´è§‚ï¼Œé€šè¿‡å›¾åƒå¯ä»¥ç›´æ¥çŸ¥é“æ¨¡å‹è¡¨é¢çš„å‡¹å‡¸æƒ…å†µ
* **ç¼ºç‚¹ï¼š** è®¡ç®—å¤æ‚ï¼Œä¸èƒ½ç›´æ¥è·å–æ¨¡å‹è¡¨é¢æ³•çº¿ï¼Œè€Œæ˜¯éœ€è¦æ ¹æ®é«˜åº¦è´´å›¾åƒç´ ä¸­çš„**ç°åº¦å€¼**è®¡ç®—å¾—å‡º

![é«˜åº¦è´´å›¾](./res/é«˜åº¦è´´å›¾.png)

### æ³•çº¿è´´å›¾

æ³•çº¿è´´å›¾ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç›´æ¥å°†æ¨¡å‹è¡¨é¢çš„æ³•ç›¸æ–¹å‘å­˜å‚¨åœ¨å›¾åƒä¸­ã€‚

* **æ³•çº¿æ˜ å°„**
  ç”±äºæ³•çº¿æ–¹å‘çš„åˆ†é‡èŒƒå›´åœ¨[-1, 1]ï¼Œè€Œåƒç´ çš„åˆ†é‡èŒƒå›´åœ¨[0, 1]ï¼Œæ‰€ä»¥éœ€è¦å°†æ³•çº¿è¿›è¡Œä¸€æ¬¡æ˜ å°„ã€‚å…¶æ˜ å°„å…¬å¼ä¸ºï¼š

$$
pixel = (normal + 1) / 2
$$

åŒæ—¶ï¼ŒåŸºäºæ­¤å…¬å¼ä¹Ÿå¯ä»¥åå‘æ¨å¯¼å‡ºæ˜ å°„å…¬å¼çš„é€†å‡½æ•°ï¼Œç”¨äºè®¡ç®—æ³•çº¿ï¼š

$$
normal = 2 * pixel - 1
$$

* **å­˜å‚¨æ³•çº¿çš„æ–¹æ³•**
  * **åœ¨åˆ‡çº¿ç©ºé—´ä¸­å­˜å‚¨æ³•çº¿**
    * æ¯ä¸ªåƒç´ çš„æ³•çº¿å‘é‡åŸºäº**åˆ‡çº¿ç©ºé—´**
    * ä¼˜ç‚¹ï¼š
      * è‡ªç”±åº¦é«˜ï¼Œå…·æœ‰é€šç”¨æ€§
      * å¯è¿›è¡ŒUVåŠ¨ç”»
      * å¯é‡ç”¨
      * å¯å‹ç¼©
  * **åœ¨æ¨¡å‹ç©ºé—´ä¸­å­˜å‚¨æ³•çº¿**
    * æ¯ä¸ªåƒç´ çš„æ³•çº¿å‘é‡åŸºäº**æ¨¡å‹ç©ºé—´**
    * ä¼˜ç‚¹ï¼š
      * å®ç°ç®€å•
      * åœ¨çº¹ç†åæ ‡çš„ç¼åˆå¤„å’Œå°–é”çš„è¾¹è§’éƒ¨åˆ†ï¼Œå¯ä»¥æä¾›å¹³æ»‘çš„è¾¹ç•Œ
    * ç¼ºç‚¹ï¼šç”±äºæ¨¡å‹ç©ºé—´ä¸‹çš„æ³•çº¿è´´å›¾è®°å½•çš„æ˜¯**ç»å¯¹æ³•çº¿ä¿¡æ¯**ï¼Œæ‰€ä»¥è¿™ç±»æ³•çº¿è´´å›¾ä»…é€‚ç”¨äºåˆ›å»ºè´´å›¾æ—¶çš„æ¨¡å‹ï¼Œä¸å…·æœ‰é€šç”¨æ€§

> ğŸ“Œ**Note: DirectXå’ŒOpenGLä¸‹çš„æ³•çº¿è´´å›¾å·®å¼‚**
>
> * DirectXä½¿ç”¨**å·¦æ‰‹åæ ‡ç³»**ï¼ŒYè½´å‘ä¸Šï¼›OpenGLä½¿ç”¨**å³æ‰‹åæ ‡ç³»**ï¼ŒYè½´å‘ä¸‹ã€‚å› æ­¤ä¸¤è€…çš„æ³•çº¿è´´å›¾çš„å‡¹å‡¸æƒ…å†µæ˜¯ç›¸åçš„
> * Unityé»˜è®¤ä½¿ç”¨**å·¦æ‰‹åæ ‡ç³»**ï¼Œå³DirectXé£æ ¼
>
> ![DirectXå’ŒOpenGLä¸‹çš„æ³•çº¿è´´å›¾](./res/OpenGLå’ŒDirectXä¸‹çš„æ³•çº¿è´´å›¾.png)

---

## å‡¹å‡¸è´´å›¾ç€è‰²å™¨å®ç°

### å±æ€§

```hlsl
_Color ("é¢œè‰²", Color) = (1, 1, 1, 1)
_MainTex ("ä¸»çº¹ç†", 2D) = "white" {}
_BumpMap ("æ³•çº¿çº¹ç†", 2D) = "bump" {}//bump-Unityå†…ç½®çš„æ³•çº¿çº¹ç†
_BumpScale ("å‡¹å‡¸æ¯”ä¾‹", Range(0, 1)) = 1
_Specular ("é«˜å…‰åå°„é¢œè‰²", Color) = (1, 1, 1, 1)
_Gloss ("å…‰æ³½åº¦", Range(8.0, 256)) = 20
```

åœ¨ç€è‰²å™¨ä¸­å®šä¹‰çº¹ç†å±æ€§ï¼šé¢œè‰²ã€ä¸»çº¹ç†ã€æ³•çº¿çº¹ç†ã€å‡¹å‡¸æ¯”ä¾‹ã€é«˜å…‰åå°„é¢œè‰²ã€å…‰æ³½åº¦ã€‚å…¶ä¸­ï¼š

* é¢œè‰²ï¼šç”¨äºæè¿°ç‰©ä½“è‡ªèº«é¢œè‰²
* ä¸»çº¹ç†ï¼šç”¨äºæè¿°ç‰©ä½“çš„æ¼«åå°„é¢œè‰²çš„çº¹ç†å›¾ç‰‡ï¼Œé»˜è®¤æ˜¯ä¸€ä¸ªçº¯ç™½çš„çº¹ç† **ï¼ˆæ³¨ï¼šwhiteæ˜¯Unityå†…ç½®çš„çº¯ç™½çº¹ç†ï¼‰**
* æ³•çº¿çº¹ç†ï¼šç”¨äºæè¿°ç‰©ä½“çš„æ³•çº¿çº¹ç†å›¾ç‰‡ï¼Œé»˜è®¤æ˜¯Unityå†…ç½®çš„æ³•çº¿çº¹ç† **ï¼ˆæ³¨ï¼šbumpæ˜¯Unityå†…ç½®çš„æ³•çº¿çº¹ç†ï¼‰**
* å‡¹å‡¸æ¯”ä¾‹ï¼šç”¨äºæ§åˆ¶æ³•çº¿çº¹ç†åœ¨è®¡ç®—å…‰ç…§æ—¶çš„å‡¹å‡¸æ¯”ä¾‹
* é«˜å…‰åå°„é¢œè‰²ï¼šç”¨äºæè¿°ç‰©ä½“çš„é«˜å…‰åå°„é¢œè‰²
* å…‰æ³½åº¦ï¼šç”¨äºæè¿°ç‰©ä½“çš„å…‰æ³½åº¦

### ç€è‰²å™¨å˜é‡

```hlsl
fixed4 _Color;
sampler2D _MainTex;//ä¸»çº¹ç†
float4 _MainTex_ST;//ä¸»çº¹ç†å±æ€§
sampler2D _BumpMap;//æ³•çº¿çº¹ç†
float4 _BumpMap_ST;//æ³•çº¿çº¹ç†å±æ€§
float _BumpScale;//å‡¹å‡¸æ¯”ä¾‹
fixed4 _Specular;
float _Gloss;
```

å®šä¹‰ä¸å±æ€§ç›¸åŒ¹é…çš„ç€è‰²å™¨å˜é‡ã€‚è®¾è®¡æ€è·¯å¦‚ä¸‹ï¼š

* ä½¿ç”¨ `sampler2D` è¡¨ç¤ºçº¹ç†èµ„æº
  * `sampler2D`ï¼š2Dçº¹ç†é‡‡æ ·å™¨ï¼Œç”¨äºè®¿é—®ä¸»çº¹ç†å›¾åƒçš„æ•°æ®
  * åœ¨ç€è‰²å™¨ä¸­ï¼Œä½¿ç”¨å‡½æ•° `tex2D(_MainTex, uv)`å®ç°å¯¹äºçº¹ç†çš„é‡‡æ ·ï¼Œè·å¾—å¯¹åº”uvåæ ‡ä¸‹çš„é¢œè‰²ç­‰æ•°æ®
* ä½¿ç”¨ `float4 _MainTex_ST` è¡¨ç¤ºçº¹ç†å±æ€§
  * `_MainTex_ST.xy`ï¼šå­˜å‚¨çº¹ç†çš„ç¼©æ”¾å€¼(Tiling)ï¼Œç”¨äºæ§åˆ¶çº¹ç†åœ¨ç‰©ä½“è¡¨é¢ä¸Šé‡å¤çš„æ¬¡æ•°
  * `_MainTex_ST.zw`ï¼šå­˜å‚¨çº¹ç†çš„å¹³ç§»å€¼(Offset)ï¼Œæ§åˆ¶çº¹ç†åœ¨è¡¨é¢ä¸Šçš„èµ·å§‹ä½ç½®ï¼ˆå³çº¹ç†çš„uvåæ ‡åœ¨çº¹ç†åæ ‡ç³»ä¸­çš„åç§»å€¼ï¼‰
  * åœ¨UnityCG.cgincä¸­å®šä¹‰äº† `TRANSFORM_TEX` å®ï¼Œç”¨äºå°†çº¹ç†çš„uvåæ ‡è¿›è¡Œç¼©æ”¾å’Œå¹³ç§»ï¼Œå¹¶è¿”å›ç»“æœ
* ä½¿ç”¨ `float4 _BumpMap_ST` è¡¨ç¤ºæ³•çº¿çº¹ç†å±æ€§
  * `_BumpMap_ST.xy`ï¼šå­˜å‚¨æ³•çº¿çº¹ç†çš„ç¼©æ”¾å€¼(Tiling)ï¼Œç”¨äºæ§åˆ¶æ³•çº¿çº¹ç†åœ¨ç‰©ä½“è¡¨é¢ä¸Šé‡å¤çš„æ¬¡æ•°
  * `_BumpMap_ST.zw`ï¼šå­˜å‚¨æ³•çº¿çº¹ç†çš„å¹³ç§»å€¼(Offset)ï¼Œæ§åˆ¶æ³•çº¿çº¹ç†åœ¨è¡¨é¢ä¸Šçš„èµ·å§‹ä½ç½®ï¼ˆå³çº¹ç†çš„uvåæ ‡åœ¨çº¹ç†åæ ‡ç³»ä¸­çš„åç§»å€¼ï¼‰

### åœ¨åˆ‡çº¿ç©ºé—´ä¸­è¿›è¡Œå…‰ç…§è®¡ç®—

```hlsl

Shader "Custom/NormalMapTangentSpace"
{
    Properties
    {
        _Color ("é¢œè‰²", Color) = (1, 1, 1, 1)
        _MainTex ("ä¸»çº¹ç†", 2D) = "white" {}
        _BumpMap ("æ³•çº¿çº¹ç†", 2D) = "bump" {}//bump-Unityå†…ç½®çš„æ³•çº¿çº¹ç†
        _BumpScale ("å‡¹å‡¸æ¯”ä¾‹", Range(0, 1)) = 1
        _Specular ("é«˜å…‰åå°„é¢œè‰²", Color) = (1, 1, 1, 1)
        _Gloss ("å…‰æ³½åº¦", Range(8.0, 256)) = 20
    }

    SubShader
    {
        Pass
        {
            Tags { "LightMode" = "ForwardBase" }

            CGPROGRAM

            #pragma vertex vert
            #pragma fragment frag

            #include "Lighting.cginc"

            fixed4 _Color;
            sampler2D _MainTex;//ä¸»çº¹ç†
            float4 _MainTex_ST;//ä¸»çº¹ç†å±æ€§
            sampler2D _BumpMap;//æ³•çº¿çº¹ç†
            float4 _BumpMap_ST;//æ³•çº¿çº¹ç†å±æ€§
            float _BumpScale;//å‡¹å‡¸æ¯”ä¾‹
            fixed4 _Specular;
            float _Gloss;

            struct a2v
            {
                float4 vertex :POSITION;
                float3 normal : NORMAL;
                float4 tangent : TANGENT;
                float4 texcoord : TEXCOORD0;
            };

            struct v2f
            {
                float4 pos : SV_POSITION;
                float4 uv : TEXCOORD0;
                float3 lightDir : TEXCOORD1;
                float3 viewDir : TEXCOORD2;
            };

            v2f vert(a2v v)
            {
                v2f o;
                o.pos = UnityObjectToClipPos(v.vertex);
                o.uv.xy = v.texcoord.xy * _MainTex_ST.xy + _MainTex_ST.zw;
                o.uv.zw = v.texcoord.xy * _BumpMap_ST.xy + _BumpMap_ST.zw;

                //è®¡ç®—å‰¯æ³•çº¿
                TANGENT_SPACE_ROTATION;

                //è®¡ç®—å…‰ç…§æ–¹å‘
                o.lightDir = mul(rotation, ObjSpaceLightDir(v.vertex)).xyz;
                //è®¡ç®—è§†è§’æ–¹å‘
                o.viewDir = mul(rotation, ObjSpaceViewDir(v.vertex)).xyz;

                return o;
            }

            fixed4 frag(v2f i) : SV_Target
            {
                fixed3 tangentLightDir = normalize(i.lightDir);
                fixed3 tangentViewDir = normalize(i.viewDir);

                fixed4 packedNormal = tex2D(_BumpMap, i.uv.zw);
                fixed3 tangentNormal = UnpackNormal(packedNormal);
                tangentNormal.xy *= _BumpScale;
                tangentNormal.z = sqrt(1.0 - saturate(dot(tangentNormal.xy, tangentNormal.xy)));

                fixed3 albedo = tex2D(_MainTex, i.uv.xy).rgb * _Color.rgb;

                fixed3 ambient = UNITY_LIGHTMODEL_AMBIENT.rgb * albedo;

                fixed3 diffuse = _LightColor0.rgb * albedo * saturate(dot(tangentNormal, tangentLightDir));

                fixed3 halfDir = normalize(tangentLightDir + tangentViewDir);
                fixed3 specular = _LightColor0.rgb * _Specular.rgb * pow(saturate(dot(tangentNormal, halfDir)), _Gloss);

                return fixed4(ambient + diffuse + specular, 1.0);
            }

            ENDCG
        }
    }
    FallBack "Specular"
}
```

### æ•ˆæœ

![å‡¹å‡¸è´´å›¾](./res/å‡¹å‡¸è´´å›¾.png)

å·¦ä¾§ä¸ºåŸºç¡€è´´å›¾ï¼Œå³ä¾§ä¸ºå‡¹å‡¸è´´å›¾ï¼Œå¯ä»¥çœ‹å‡ºåŠ ä¸Šæ³•çº¿è´´å›¾åï¼Œç‰©ä½“çš„å‡¹å‡¸æ•ˆæœä¼šæ›´æ˜æ˜¾ã€‚

---

## Reference

* ã€ŠUnityShaderå…¥é—¨ç²¾è¦ã€‹
* [å¿«é€Ÿåˆ¤æ–­OpenGLå’ŒDirectXæ³•çº¿çš„æŠ€å·§ - é±¼é¦™èŠ¥æœ«çš„æ–‡ç«  - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/341708714)
